{"version":3,"sources":["webpack:///src/components/Im/Dialog.vue","webpack:///./src/components/Im/Dialog.vue?322d","webpack:///./src/components/Im/Dialog.vue","webpack:///src/components/Im/Chat.vue","webpack:///./src/components/Im/Chat.vue?b638","webpack:///./src/components/Im/Chat.vue","webpack:///src/pages/User/Im.vue","webpack:///./src/pages/User/Im.vue?255f","webpack:///./src/pages/User/Im.vue"],"names":["Dialog","name","props","active","Boolean","push","Number","online","me","info","Object","computed","statusText","this","$t","moment_default","recipient_id","last_online_time","fromNow","i18n","messages","en","was","ru","Im_Dialog","render","_vm","_h","$createElement","_c","_self","staticClass","class","attrs","to","params","id","src","photo","alt","first_name","__webpack_require__","_v","_s","last_name","last_message","_e","message_text","_f","time","staticRenderFns","components_Im_Dialog","normalizeComponent","ssrContext","Chat","Array","components","VirtualList","dist_default","a","data","mes","itemComponent","ChatMessage","isUserViewHistory","fetching","offset","itemPrePage","mounted","follow","setVirtualListToBottom","watch","extends_default","vuex_esm","messagesGrouped","groups","headerDate","forEach","msg","msgDate","format","sid","stubDate","date","makeHeader","checkTypingMessage","_this","user","getTypeMessage","el","dialog","getActiveDialogId","author","methods","onSubmitMessage","postMessage","finishedTypingMessage","onScrollToTop","_this2","asyncToGenerator_default","regenerator_default","mark","_callee","wrap","_context","prev","next","$refs","vsl","length","total","loadOlderMessages","itemPerPage","then","setVirtualListToOffset","$nextTick","scrollOffset","getScrollSize","stop","onScroll","onScrollToBottom","scrollToOffset","scrollToBottom","typingMessage","getInfo","socetIO","resetCounterUnreadedDialogs","unread_count","setUnreadedDialogs","nomore","placeholder","Im_Chat","on","click","_m","ref","size","keeps","data-key","data-sources","data-component","wrap-class","root-tag","totop","&scroll","$event","tobottom","directives","rawName","value","expression","slot","isHistoryEndReached","action","submit","preventDefault","type","domProps","input","target","composing","blur","Im","ImDialog","ImChat","Chat_normalizeComponent","isLoading","intervalForMessages","isLoad","getMessages","countPush","unread","checkOnlineUser","diff","clickOnDialog","dialogId","$router","query","getActiveDialog","selectDialogByRoute","route","vm","activeDialogID","switchDialog","userId","createDialogWithUser","getDialogs","apiLoadAllDialogs","resp","console","log","beforeRouteEnter","from","_ref","_callee2","_context2","_x","apply","arguments","beforeRouteUpdate","beforeDestroy","closeDialog","User_Im","_l","key","sendByMe","nativeOn","Im_Component","Im_normalizeComponent","__webpack_exports__"],"mappings":"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","file":"static/js/4.6492da5bb75a502f143e.js","sourcesContent":["<template lang=\"pug\">\r\n  .im-dialog(:class=\"{active, push}\")\r\n    router-link.im-dailog__pic(:to=\"{name: 'ProfileId', params: {id: info.recipient_id.id}}\")\r\n      img(v-if='info.recipient_id.photo' :src=\"info.recipient_id.photo\" :alt=\"info.recipient_id.first_name\")\r\n      img(v-else src=\"../../../static/img/user/default_avatar.svg\" :alt=\"info.recipient_id.first_name\")\r\n    .im-dialog__info\r\n      router-link.im-dialog__name(:to=\"{name: 'ProfileId', params: {id: info.recipient_id.id}}\") {{info.recipient_id.first_name + ' ' + info.recipient_id.last_name}}\r\n      span.user-status(:class=\"{online}\") {{statusText}}\r\n    .im-dialog__content\r\n      p.im-dialog__last\r\n        span.im-dialog__last-me(v-if=\"me && info.last_message\") Вы:\r\n        | {{info.last_message.message_text}}\r\n      span.im-dialog__time(v-if=\"me && info.last_message\") {{info.last_message.time - 60*60*3 | moment('from')}}\r\n    span.im-dialog__push(v-if=\"push > 0\") {{push}}\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\nexport default {\r\n  name: 'ImDialog',\r\n  props: {\r\n    active: Boolean,\r\n    push: Number,\r\n    online: Boolean,\r\n    me: Boolean,\r\n    info: Object\r\n  },\r\n  computed: {\r\n    statusText() {\r\n      return this.online\r\n        ? this.$t('online')\r\n        : this.$t('was') + moment(this.info.recipient_id.last_online_time).fromNow()\r\n    }\r\n  },\r\n  i18n: {\r\n    messages: {\r\n      en: {\r\n        online: 'Online',\r\n        was: 'was online '\r\n      },\r\n      ru: {\r\n        online: 'Онлайн',\r\n        was: 'был в сети '\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n@import '../../assets/stylus/base/vars.styl';\r\n\r\n.im-dialog {\r\n  display: flex;\r\n  align-items: center;\r\n  height: 100px;\r\n  position: relative;\r\n  padding: 0 6.38%;\r\n  z-index: 1;\r\n  cursor: pointer;\r\n  &:hover {\r\n    background-color: #c1c1c1;\r\n  }\r\n\r\n  &:before {\r\n    content: '';\r\n    display: none;\r\n    width: 100%;\r\n    height: 100%;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    background-color: #F8FAFD;\r\n    z-index: -1;\r\n  }\r\n\r\n  &:after {\r\n    content: '';\r\n    display: block;\r\n    height: 1px;\r\n    width: 87.24%;\r\n    background-color: #E3E8EE;\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n  }\r\n\r\n  &.push + &.active, &.active + &.push {\r\n    &:after {\r\n      display: none;\r\n    }\r\n  }\r\n\r\n  &.active {\r\n    &:after {\r\n      display: none;\r\n    }\r\n\r\n    &:before {\r\n      display: block;\r\n    }\r\n  }\r\n\r\n  &.push {\r\n    &:after {\r\n      display: none;\r\n    }\r\n\r\n    &:before {\r\n      display: block;\r\n      background-color: #E9F5EF;\r\n    }\r\n\r\n    .im-dialog__content {\r\n      max-width: 30%;\r\n    }\r\n\r\n    .im-dialog__time {\r\n      color: #7D9A8B;\r\n    }\r\n  }\r\n}\r\n\r\n.im-dailog__pic {\r\n  width: 60px;\r\n  height: 60px;\r\n  border-radius: 50%;\r\n  overflow: hidden;\r\n  margin-right: 15px;\r\n  flex: none;\r\n}\r\n\r\n.im-dialog__info {\r\n  width: 100%;\r\n  max-width: 27.11%;\r\n  min-width: 150px;\r\n  margin-right: 30px;\r\n\r\n  @media (max-width: breakpoint-xl) {\r\n    display: none;\r\n  }\r\n}\r\n\r\n.im-dialog__name {\r\n  font-size: 15px;\r\n  line-height: 22px;\r\n  color: steel-gray;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n.im-dialog__content {\r\n  max-width: 37%;\r\n\r\n  @media (max-width: breakpoint-xl) {\r\n    display: none;\r\n  }\r\n}\r\n\r\n.im-dialog__last {\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  font-size: 13px;\r\n  line-height: 18px;\r\n  letter-spacing: -0.003em;\r\n\r\n  &-me {\r\n    color: eucalypt;\r\n  }\r\n}\r\n\r\n.im-dialog__time {\r\n  color: #A4A4B8;\r\n  font-size: 13px;\r\n  line-height: 19px;\r\n}\r\n\r\n.im-dialog__push {\r\n  width: 27px;\r\n  height: 27px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 15px;\r\n  line-height: 27px;\r\n  font-weight: 600;\r\n  color: #fff;\r\n  background-color: #E65151;\r\n  margin-left: auto;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/Im/Dialog.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"im-dialog\",class:{active: _vm.active, push: _vm.push}},[_c('router-link',{staticClass:\"im-dailog__pic\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.info.recipient_id.id}}}},[(_vm.info.recipient_id.photo)?_c('img',{attrs:{\"src\":_vm.info.recipient_id.photo,\"alt\":_vm.info.recipient_id.first_name}}):_c('img',{attrs:{\"src\":require(\"../../../static/img/user/default_avatar.svg\"),\"alt\":_vm.info.recipient_id.first_name}})]),_c('div',{staticClass:\"im-dialog__info\"},[_c('router-link',{staticClass:\"im-dialog__name\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.info.recipient_id.id}}}},[_vm._v(_vm._s(_vm.info.recipient_id.first_name + ' ' + _vm.info.recipient_id.last_name))]),_c('span',{staticClass:\"user-status\",class:{online: _vm.online}},[_vm._v(_vm._s(_vm.statusText))])],1),_c('div',{staticClass:\"im-dialog__content\"},[_c('p',{staticClass:\"im-dialog__last\"},[(_vm.me && _vm.info.last_message)?_c('span',{staticClass:\"im-dialog__last-me\"},[_vm._v(\"Вы:\")]):_vm._e(),_vm._v(_vm._s(_vm.info.last_message.message_text))]),(_vm.me && _vm.info.last_message)?_c('span',{staticClass:\"im-dialog__time\"},[_vm._v(_vm._s(_vm._f(\"moment\")(_vm.info.last_message.time - 60*60*3,'from')))]):_vm._e()]),(_vm.push > 0)?_c('span',{staticClass:\"im-dialog__push\"},[_vm._v(_vm._s(_vm.push))]):_vm._e()],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-75a6baf4\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Im/Dialog.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-75a6baf4\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Dialog.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Dialog.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Dialog.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-75a6baf4\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Dialog.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Im/Dialog.vue\n// module id = null\n// module chunks = ","<template lang=\"pug\">\r\n  .im-chat(@click='resetCounterUnreadedDialogs')\r\n    .im-chat__user\r\n      router-link.im-chat__user-pic(:to=\"{name: 'ProfileId', params: {id: info.recipient_id.id}}\")\r\n        img(v-if='info.recipient_id.photo' :src=\"info.recipient_id.photo\" :alt=\"info.recipient_id.first_name\")\r\n        img(v-else src=\"../../../static/img/user/default_avatar.svg\" :alt=\"info.recipient_id.first_name\")\r\n      router-link.im-chat__user-name(:to=\"{name: 'ProfileId', params: {id: info.recipient_id.id}}\") {{info.recipient_id.first_name + ' ' + info.recipient_id.last_name}}\r\n      .typing(v-if='checkTypingMessage' )\r\n        .typing__animations-block\r\n          .typing__animations-item\r\n          .typing__animations-item\r\n          .typing__animations-item\r\n        p.typing__text {{checkTypingMessage}} набирает сообщение\r\n      span.user-status(:class=\"{online}\") {{statusText}}\r\n    .im-chat__infitite_list_wrapper(v-if='messages')\r\n      virtual-list.im-chat__infitite_list.scroll-touch(:size=\"60\"\r\n        :keeps=\"120\"\r\n        :data-key=\"'sid'\"\r\n        :data-sources=\"messagesGrouped\"\r\n        :data-component=\"itemComponent\"\r\n        :wrap-class=\"'im-chat__message'\"\r\n        :root-tag=\"'section'\"\r\n        @totop=\"onScrollToTop\"\r\n        @scroll.passive=\"onScroll\"\r\n        @tobottom=\"onScrollToBottom\"\r\n        ref=\"vsl\"\r\n      )\r\n        .im-chat__loader(slot=\"header\", v-show=\"fetching\")\r\n          .spinner(v-show=\"!isHistoryEndReached()\")\r\n          .finished(v-show=\"isHistoryEndReached()\") {{ $t('nomore') }}\r\n    form.im-chat__enter(action=\"#\" @submit.prevent=\"onSubmitMessage\")\r\n      input.im-chat__enter-input(type=\"text\" @input='typingMessage' @blur='finishedTypingMessage' :placeholder=\"$t('placeholder')\" v-model=\"mes\")\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\nimport { mapActions, mapGetters, mapMutations } from 'vuex'\r\nimport ChatMessage from '@/components/Im/ChatMessage'\r\nimport VirtualList from 'vue-virtual-scroll-list'\r\nimport { submitFinishTypingMessage, submitTypingMessage } from '../../api/socetIO'\r\n\r\nconst makeHeader = msgDate => {\r\n  return { sid: `group-${msgDate}`, stubDate: true, date: msgDate }\r\n}\r\nexport default {\r\n  name: 'ImChat',\r\n  props: {\r\n    info: Object,\r\n    messages: Array,\r\n    online: Boolean,\r\n  },\r\n  components: { VirtualList },\r\n  data: () => ({\r\n    mes: '',\r\n    itemComponent: ChatMessage,\r\n    isUserViewHistory: false,\r\n    fetching: false,\r\n    offset: 0,\r\n    itemPrePage: 10,\r\n  }),\r\n  mounted() {\r\n    this.follow = true;\r\n    this.setVirtualListToBottom();\r\n  },\r\n  watch: {\r\n    messages() {\r\n      if (this.follow) this.setVirtualListToBottom()\r\n    },\r\n  },\r\n  computed: {\r\n    ...mapGetters('profile/dialogs', ['getTotalMessage', 'getActiveDialogId', 'getTypeMessage', 'getMessages']),\r\n    ...mapGetters('profile/info', ['getInfo']),\r\n    statusText() {\r\n      return this.online\r\n        ? this.$t('online')\r\n        : this.$t('was') + moment(this.info.recipient_id.last_online_time).fromNow()\r\n    },\r\n    messagesGrouped() {\r\n      let groups = []\r\n      let headerDate = null\r\n      this.messages.forEach( msg => {\r\n        let msgDate = moment(msg.time).format('YYYY-MM-DD')\r\n        if (msgDate !== headerDate) {\r\n          headerDate = msgDate\r\n          groups.push(makeHeader(headerDate))\r\n        }\r\n        groups.push(msg)\r\n      })\r\n      return groups\r\n    },\r\n    checkTypingMessage() {\r\n      let user\r\n      this.getTypeMessage.forEach(el=> {\r\n        if (el.dialog == this.getActiveDialogId) {\r\n          user = el.author\r\n        }\r\n      })\r\n      return user\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions('profile/dialogs', ['postMessage', 'loadOlderMessages']),\r\n    ...mapGetters('profile/dialogs', ['isHistoryEndReached']),\r\n    ...mapMutations('profile/dialogs', ['setUnreadedDialogs']),\r\n    onSubmitMessage() {\r\n      if(this.mes == '') return\r\n      this.postMessage({ id: this.info.id, message_text: this.mes })\r\n      this.mes = ''\r\n      this.finishedTypingMessage()\r\n    },\r\n    async onScrollToTop() {\r\n      if (this.$refs.vsl) {\r\n\r\n        if (this.messages.length < this.messages[0].total) {\r\n          let oldest = this.messagesGrouped[0]\r\n\r\n          this.fetching = true\r\n          await this.loadOlderMessages({itemPerPage: this.itemPrePage, offset: this.offset + this.itemPrePage}).then(()=>{\r\n            this.offset += this.itemPrePage;\r\n          })\r\n          this.setVirtualListToOffset(1)\r\n\r\n          this.$nextTick(() => {\r\n            const scrollSize = this.$refs.vsl.getScrollSize()\r\n            const scrollOffset = scrollSize / this.offset;\r\n            this.setVirtualListToOffset(scrollOffset * this.itemPrePage)\r\n            this.fetching = false\r\n          })\r\n        }\r\n      }\r\n    },\r\n    onScroll() {\r\n      this.follow = false\r\n    },\r\n    onScrollToBottom() {\r\n      this.follow = true\r\n    },\r\n    setVirtualListToOffset(offset) {\r\n      if (this.$refs.vsl) {\r\n        this.$refs.vsl.scrollToOffset(offset)\r\n      }\r\n    },\r\n    setVirtualListToBottom() {\r\n      if (this.$refs.vsl) {\r\n        this.$refs.vsl.scrollToBottom()\r\n      }\r\n    },\r\n    typingMessage(){\r\n      if(this.mes){\r\n        const data = {\r\n          author: this.getInfo.id,\r\n          dialog: this.getActiveDialogId\r\n        }\r\n        submitTypingMessage(data)\r\n      }\r\n    },\r\n    finishedTypingMessage(){\r\n      const data = {\r\n        author: Number(this.getInfo.id),\r\n        dialog: Number(this.getActiveDialogId)\r\n      }\r\n      submitFinishTypingMessage(data)\r\n    },\r\n    resetCounterUnreadedDialogs(){\r\n      const params = {\r\n        id: this.getActiveDialogId,\r\n        unread_count: 0\r\n      }\r\n      this.setUnreadedDialogs(params)\r\n    }\r\n  },\r\n  i18n: {\r\n    messages: {\r\n      en: {\r\n        nomore: 'No more messages',\r\n        placeholder: 'Your message...',\r\n        online: 'Online',\r\n        was: 'was online '\r\n      },\r\n      ru: {\r\n        nomore: 'Больше сообщений нет',\r\n        placeholder: 'Ваше сообщение...',\r\n        online: 'Онлайн',\r\n        was: 'был в сети '\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n@import '../../assets/stylus/base/vars.styl';\r\n\r\n.im-chat {\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n}\r\n\r\n.im-chat__user {\r\n  border-bottom: 1px solid #E3E8EE;\r\n  display: flex;\r\n  align-items: center;\r\n  height: 60px;\r\n  padding: 30px 20px;\r\n  font-size: 13px;\r\n  background-color: #F8FAFD;\r\n}\r\n\r\n.im-chat__user-pic {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  overflow: hidden;\r\n  margin-right: 10px;\r\n}\r\n\r\n.im-chat__user-name {\r\n  font-weight: 600;\r\n  color: steel-gray;\r\n  margin-right: auto;\r\n}\r\n\r\n.typing{\r\n  margin-right auto\r\n  display flex\r\n  &__animations-block{\r\n    display flex\r\n    align-items flex-end\r\n    padding-bottom 2px\r\n    margin-right 5px\r\n  }\r\n\r\n  &__animations-item{\r\n      display block\r\n      width 4px\r\n      height 4px\r\n      background grey\r\n      border-radius 50%\r\n\r\n      &:not(:last-child){\r\n        margin-right 2px\r\n      }\r\n\r\n      animation-name: loadAnimations;\r\n      animation-duration: 1.8s;\r\n      animation-timing-function: linear;\r\n      animation-iteration-count: infinite;\r\n\r\n      &:nth-child(1) {\r\n        -webkit-animation-delay: 0.0s;\r\n      }\r\n\r\n      &:nth-child(2) {\r\n        -webkit-animation-delay: 0.6s;\r\n      }\r\n\r\n      &:nth-child(3) {\r\n        -webkit-animation-delay: 1.2s;\r\n      }\r\n  }\r\n\r\n  &__text{\r\n    &:first-letter{\r\n      text-transform uppercase\r\n    }\r\n  }\r\n}\r\n\r\n.im-chat__user-status {\r\n  color: #9EA4AD;\r\n\r\n  &.online {\r\n    color: eucalypt;\r\n  }\r\n}\r\n\r\n.im-chat__infitite_list_wrapper {\r\n  position: relative;\r\n  flex: 1;\r\n}\r\n\r\n.im-chat__infitite_list {\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  overflow-y: auto;\r\n}\r\n\r\n.im-chat__message > div {\r\n  padding-left: 30px;\r\n  padding-right: 30px;\r\n  padding: 20px;\r\n}\r\n\r\n.im-chat__enter {\r\n  display: block;\r\n  width: 100%;\r\n}\r\n\r\n.im-chat__enter-input {\r\n  width: 100%;\r\n  background-color: #fff;\r\n  padding: 0 40px;\r\n  font-size: 15px;\r\n  color: steel-gray;\r\n  height: 60px;\r\n\r\n  &::placeholder {\r\n    color: #B0B0BC;\r\n  }\r\n}\r\n\r\n\r\n.im-chat__loader {\r\n  padding: 1em;\r\n  .finished {\r\n    font-size: 14px;\r\n    text-align: center;\r\n    color: #bfbfbf;\r\n  }\r\n  .spinner {\r\n    font-size: 10px;\r\n    margin: 0px auto;\r\n    text-indent: -9999em;\r\n    width: 25px;\r\n    height: 25px;\r\n    border-radius: 50%;\r\n    background: #ffffff;\r\n    background: linear-gradient(to right, eucalypt 10%, rgba(255, 255, 255, 0) 42%);\r\n    position: relative;\r\n    animation: load3 1.4s infinite linear;\r\n    transform: translateZ(0);\r\n  }\r\n  .spinner:before {\r\n    width: 50%;\r\n    height: 50%;\r\n    background: eucalypt;\r\n    border-radius: 100% 0 0 0;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    content: '';\r\n  }\r\n  .spinner:after {\r\n    background: #f8fafd;\r\n    width: 75%;\r\n    height: 75%;\r\n    border-radius: 50%;\r\n    content: '';\r\n    margin: auto;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    bottom: 0;\r\n    right: 0;\r\n  }\r\n  @-webkit-keyframes load3 {\r\n    0% {\r\n      transform: rotate(0deg);\r\n    }\r\n    100% {\r\n      transform: rotate(360deg);\r\n    }\r\n  }\r\n  @keyframes load3 {\r\n    0% {\r\n      transform: rotate(0deg);\r\n    }\r\n    100% {\r\n      transform: rotate(360deg);\r\n    }\r\n  }\r\n}\r\n\r\n@keyframes loadAnimations {\r\n  0% {\r\n    opacity: 0.3;\r\n    transition: opacity 0.3s;\r\n  }\r\n\r\n  70% {\r\n    opacity: 1;\r\n    transition: opacity 0.3s;\r\n  }\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/Im/Chat.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"im-chat\",on:{\"click\":_vm.resetCounterUnreadedDialogs}},[_c('div',{staticClass:\"im-chat__user\"},[_c('router-link',{staticClass:\"im-chat__user-pic\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.info.recipient_id.id}}}},[(_vm.info.recipient_id.photo)?_c('img',{attrs:{\"src\":_vm.info.recipient_id.photo,\"alt\":_vm.info.recipient_id.first_name}}):_c('img',{attrs:{\"src\":require(\"../../../static/img/user/default_avatar.svg\"),\"alt\":_vm.info.recipient_id.first_name}})]),_c('router-link',{staticClass:\"im-chat__user-name\",attrs:{\"to\":{name: 'ProfileId', params: {id: _vm.info.recipient_id.id}}}},[_vm._v(_vm._s(_vm.info.recipient_id.first_name + ' ' + _vm.info.recipient_id.last_name))]),(_vm.checkTypingMessage)?_c('div',{staticClass:\"typing\"},[_vm._m(0),_c('p',{staticClass:\"typing__text\"},[_vm._v(_vm._s(_vm.checkTypingMessage)+\" набирает сообщение\")])]):_vm._e(),_c('span',{staticClass:\"user-status\",class:{online: _vm.online}},[_vm._v(_vm._s(_vm.statusText))])],1),(_vm.messages)?_c('div',{staticClass:\"im-chat__infitite_list_wrapper\"},[_c('virtual-list',{ref:\"vsl\",staticClass:\"im-chat__infitite_list scroll-touch\",attrs:{\"size\":60,\"keeps\":120,\"data-key\":'sid',\"data-sources\":_vm.messagesGrouped,\"data-component\":_vm.itemComponent,\"wrap-class\":'im-chat__message',\"root-tag\":'section'},on:{\"totop\":_vm.onScrollToTop,\"&scroll\":function($event){return _vm.onScroll($event)},\"tobottom\":_vm.onScrollToBottom}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.fetching),expression:\"fetching\"}],staticClass:\"im-chat__loader\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.isHistoryEndReached()),expression:\"!isHistoryEndReached()\"}],staticClass:\"spinner\"}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isHistoryEndReached()),expression:\"isHistoryEndReached()\"}],staticClass:\"finished\"},[_vm._v(_vm._s(_vm.$t('nomore')))])])])],1):_vm._e(),_c('form',{staticClass:\"im-chat__enter\",attrs:{\"action\":\"#\"},on:{\"submit\":function($event){$event.preventDefault();return _vm.onSubmitMessage($event)}}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.mes),expression:\"mes\"}],staticClass:\"im-chat__enter-input\",attrs:{\"type\":\"text\",\"placeholder\":_vm.$t('placeholder')},domProps:{\"value\":(_vm.mes)},on:{\"input\":[function($event){if($event.target.composing){ return; }_vm.mes=$event.target.value},_vm.typingMessage],\"blur\":_vm.finishedTypingMessage}})])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"typing__animations-block\"},[_c('div',{staticClass:\"typing__animations-item\"}),_c('div',{staticClass:\"typing__animations-item\"}),_c('div',{staticClass:\"typing__animations-item\"})])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2566657b\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Im/Chat.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2566657b\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Chat.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Chat.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Chat.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2566657b\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Chat.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Im/Chat.vue\n// module id = null\n// module chunks = ","<template lang=\"pug\">\r\n.im\r\n    .im__dialogs\r\n        im-dialog(\r\n            v-for='dialog in getDialogs',\r\n            :key='dialog.id',\r\n            :info='dialog',\r\n            :push='countPush(dialog.unread_count)',\r\n            :me='dialog.sendByMe',\r\n            :active='getActiveDialog && dialog.id === getActiveDialog.id',\r\n            :online='checkOnlineUser(dialog.recipient_id.last_online_time)',\r\n            @click.native='clickOnDialog(dialog.id)'\r\n        )\r\n\r\n    .im__chat(v-if='getActiveDialog && messages')\r\n        im-chat(\r\n            :info='getActiveDialog',\r\n            :messages='messages',\r\n            :online='checkOnlineUser(getActiveDialog.recipient_id.last_online_time)'\r\n        )\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\nimport { mapGetters, mapActions } from 'vuex'\r\nimport ImDialog from '@/components/Im/Dialog'\r\nimport ImChat from '@/components/Im/Chat'\r\nimport isLoading from '@/components/isLoading'\r\n\r\nexport default {\r\n  name: 'Im',\r\n  components: { ImDialog, ImChat, isLoading },\r\n  data: () => ({\r\n    intervalForMessages: null,\r\n    isLoad: false\r\n  }),\r\n\r\n  computed: {\r\n    ...mapGetters('profile/dialogs', ['getMessages', 'getActiveDialog', 'getDialogs', 'getActiveDialogId']),\r\n\r\n    messages(){\r\n      const active = Number(this.getActiveDialogId);\r\n      const message = this.getMessages[active] ? this.getMessages[active] : [];\r\n      return message;\r\n    },\r\n  },\r\n  methods: {\r\n    ...mapActions('profile/dialogs', [\r\n      'loadFreshMessages',\r\n      'switchDialog',\r\n      'closeDialog',\r\n      'createDialogWithUser',\r\n      'apiLoadAllDialogs'\r\n    ]),\r\n\r\n    countPush(unread) {\r\n      return unread > 0 ? unread : null\r\n    },\r\n    checkOnlineUser(time) {\r\n      return moment().diff(moment(time), 'seconds') <= 60\r\n    },\r\n    clickOnDialog(dialogId) {\r\n      this.$router.push({ name: 'Im', query: { getActiveDialog: dialogId } })\r\n    },\r\n    async selectDialogByRoute(route, vm) {\r\n      if (route.query.getActiveDialog) {\r\n        vm.switchDialog(route.query.getActiveDialog)\r\n      } else if (route.query.userId) {\r\n        vm.createDialogWithUser(route.query.userId)\r\n      } else if (vm.getDialogs.length > 0) {\r\n        if(this.getActiveDialogId){\r\n          const activeDialogID = this.getActiveDialogId;\r\n          vm.$router.push({ name: 'Im', query: { getActiveDialog: activeDialogID } })\r\n        }else{\r\n          vm.$router.push({ name: 'Im', query: { getActiveDialog: vm.getDialogs[0].id } })\r\n        }\r\n      } else {\r\n        await vm.apiLoadAllDialogs().then(resp => {\r\n          this.offset = resp\r\n        })\r\n        if (vm.getDialogs.length > 0) {\r\n          vm.$router.push({ name: 'Im', query: { getActiveDialog: vm.getDialogs[0].id } })\r\n        }\r\n        console.log('No dialogs at all')\r\n      }\r\n    },\r\n  },\r\n    beforeRouteEnter(to, from, next) {\r\n      next(async vm => {\r\n        vm.selectDialogByRoute(to, vm)\r\n      })\r\n    },\r\n    beforeRouteUpdate(to, from, next) {\r\n      this.selectDialogByRoute(to, this)\r\n      next()\r\n    },\r\n    beforeDestroy() {\r\n      this.closeDialog()\r\n    },\r\n  }\r\n  </script>\r\n\r\n<style lang=\"stylus\">\r\n@import '../../assets/stylus/base/vars.styl';\r\n\r\n.im {\r\n    display: flex;\r\n    height: 'calc(100vh - %s)' % header-height;\r\n}\r\n\r\n.im__dialogs {\r\n    width: 100%;\r\n    max-width: 39.13%;\r\n    overflow-y: auto;\r\n    max-height: 100%;\r\n    height: 100%;\r\n    background-color: #F2F5F9;\r\n\r\n    @media (max-width: breakpoint-xl) {\r\n        max-width: 120px;\r\n    }\r\n}\r\n\r\n.im__chat {\r\n    width: 100%;\r\n    flex: auto;\r\n    height: 100%;\r\n    background-color: #F8FAFD;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/User/Im.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"im\"},[_c('div',{staticClass:\"im__dialogs\"},_vm._l((_vm.getDialogs),function(dialog){return _c('im-dialog',{key:dialog.id,attrs:{\"info\":dialog,\"push\":_vm.countPush(dialog.unread_count),\"me\":dialog.sendByMe,\"active\":_vm.getActiveDialog && dialog.id === _vm.getActiveDialog.id,\"online\":_vm.checkOnlineUser(dialog.recipient_id.last_online_time)},nativeOn:{\"click\":function($event){return _vm.clickOnDialog(dialog.id)}}})}),1),(_vm.getActiveDialog && _vm.messages)?_c('div',{staticClass:\"im__chat\"},[_c('im-chat',{attrs:{\"info\":_vm.getActiveDialog,\"messages\":_vm.messages,\"online\":_vm.checkOnlineUser(_vm.getActiveDialog.recipient_id.last_online_time)}})],1):_vm._e()])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4b4d0b64\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/User/Im.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4b4d0b64\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Im.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Im.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Im.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4b4d0b64\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Im.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/User/Im.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}